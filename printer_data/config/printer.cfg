#
#
# - Includes
# - Steppers
#   - X, Y, Z, E + drivers (not worth cluttering up config with extras)

# - Hotend
# - Bed
# - Temp sensors: pi, mcu, enclosure 
# - Fans Hotend, Part, Stepppers, Mainboad, bed

# - ABL
#   - Probe
#   - Bed mesh
#   - Screws tilt adjust
#
# - MSC
#   - Printer
#   - Mcu

##### INCLUDES #####
[include macros.cfg]
[include klicky.cfg]
[include bedfan.cfg]



##### STEPPERS #####

# MOTOR_0, B stepper - Left
[stepper_x]
step_pin: PF13 #
dir_pin: PF12 # 
enable_pin: !PF14 #
microsteps: 16 #
rotation_distance: 40 #
endstop_pin: PG6 # 
position_endstop: 0 #
position_max: 235 # v1.0
homing_speed: 100 # v1.0

[tmc2209 stepper_x]
uart_pin: PC4 #
# diag_pin: PG6
run_current: 1 # v1.0
sense_resistor: 0.110 # THIS SHOULD NOT BE HERE (this is only here to get rid of an error)
stealthchop_threshold: 0 # v1.0
interpolate: true # The100 uses this so it must be a good idea 


# MOTOR_1, A Stepper - Right
[stepper_y]
step_pin: PG0 # 
dir_pin: PG1 #
enable_pin: !PF15 #
microsteps: 16 #
rotation_distance: 40 #
endstop_pin: PG9 #
position_endstop: 249 #
position_max: 249 #
homing_speed: 100 # v1.0
homing_positive_dir: true #

[tmc2209 stepper_y]
uart_pin: PD11 #
#diag_pin: PG9
run_current: 1 # v1.0
sense_resistor: 0.110 # THIS SHOULD NOT BE HERE (this is only here to get rid of an error)
stealthchop_threshold: 0 # v1.0
interpolate: true # The100 uses this so it must be a good idea 


# MOTOR_2_1
[stepper_z]
step_pin: PF11 #
dir_pin: PG3 #
enable_pin: !PG5 #
microsteps: 16 # 
rotation_distance: 8 # v1.0
gear_ratio: 40:20 # v1.0
endstop_pin: probe:z_virtual_endstop # v1.0
position_min: -15 # v1.0
position_max: 250 #
homing_speed: 25 # v1.0

[tmc2209 stepper_z]
uart_pin: PC6 #
# diag_pin: PG10
run_current: 0.650 #
sense_resistor: 0.110 # THIS SHOULD NOT BE HERE (this is only here to get rid of an error)
stealthchop_threshold: 999999
interpolate: true #


# MOTOR_3 
[extruder]
step_pin: PG4
dir_pin: !PC1 # v1.0
enable_pin: !PA2
microsteps: 16
gear_ratio: 44:10, 37:17 # v1.0
rotation_distance: 53.76163582 # v1.0
nozzle_diameter: 0.400
filament_diameter: 1.750
max_extrude_cross_section: 5
max_extrude_only_distance: 100.0 # v1.0
heater_pin: PA0 # HE0
sensor_pin:  PF4 # T0
sensor_type: Generic 3950 #EPCOS 100K B57560G104F  # v1.0
#control: pid
#pid_Kp: 22.2
#pid_Ki: 1.08
#pid_Kd: 114
min_temp: 0 # v1.0
max_temp: 300 # v1.0

[tmc2209 extruder]
uart_pin: PC7
run_current: 0.800
sense_resistor: 0.110 # THIS SHOULD NOT BE HERE (this is only here to get rid of an error)
stealthchop_threshold: 999999


##### BED #####
[heater_bed]
heater_pin: PA1
sensor_pin: PF3 # TB
sensor_type: Generic 3950 #EPCOS 100K B57560G104F  # v1.0
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0 # v1.0
max_temp: 120  # v1.0



##### TEMP SENSORS #####
[temperature_sensor raspberry_pi]  # v1.0
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor mcu_temp]  # v1.0
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[temperature_sensor enlosure_temp] # v1.0
sensor_type: Generic 3950
sensor_pin: PF5
min_temp: 0
max_temp: 300


##### FANS #####
# FAN_0 - Part cooling fan
[fan]
pin: PA8

# FAN_1
[heater_fan Hotend_fan]
pin: PE5

## FAN_2
#[fan_generic Bed_fan]
#pin: PD12

########## Bed Fans #########

[fan_generic BedFans]
pin: PD12
#cycle_time: 0.05
kick_start_time: 0.5


# FAN_3
[controller_fan Mainboard_fans]
pin: PD13
fan_speed: 0.80

# FAN_4
[controller_fan XY_motor_fans]
pin: PD14
stepper:stepper_x,stepper_y
fan_speed: 0.5

#[fan_generic AUX_fans]
#pin: PD15



##### ABL #####
[probe] 
pin: ^PG10 # v1.0
x_offset: 0 # negative = left of the nozzle 
y_offset: 0 # negative = in front of of the nozzle
#z_offset: 0 
speed: 10 # v1.0
lift_speed: 25
samples: 1 

[bed_mesh]
speed: 300 # v1.0 
horizontal_move_z: 22 # Probe ofset + 2 # v1.0
mesh_min: 10, 10 # (Left, Front) # v1.0
mesh_max: 222, 220 # (Right, Back) # v1.0
probe_count: 7,7 # v1.0  
algorithm: bicubic
fade_end: 10
adaptive_margin: 10 # v1.0

[screws_tilt_adjust]
screw1: 32,9
screw1_name: Bottom Left
screw2: 202,9
screw2_name: Bottom Right
screw3: 202,179
screw3_name: Upper Right
screw4: 32,179
screw4_name: Upper Left
speed: 120
#   The speed (in mm/s) of non-probing moves during the calibration.
#   The default is 50.
#horizontal_move_z: # Probe ofset + 2 ()
horizontal_move_z: 25 # Probe ofset + 5 # v1.0
screw_thread: CW-M4




##### MSC #####
[printer]
kinematics: corexy
max_velocity: 500
max_accel: 20000
max_z_velocity: 25
max_z_accel: 500
square_corner_velocity: 10.0

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_27003C000851313339373836-if00
#restart_method: command


[exclude_object] # Needed for adaptive meshing

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_version = 1
#*# pid_target = 60.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 15.649
#*# pid_ki = 0.278
#*# pid_kd = 220.264
#*#
#*# [extruder]
#*# pid_version = 1
#*# pid_target = 225.00
#*# pid_tolerance = 0.0200
#*# control = pid
#*# pid_kp = 46.488
#*# pid_ki = 14.304
#*# pid_kd = 37.772
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.492500, 0.115000, -0.241250, -0.596250, -0.875000
#*# 	0.641250, 0.267500, -0.072500, -0.461250, -0.773750
#*# 	0.761250, 0.375000, -0.018750, -0.411250, -0.810000
#*# 	0.836250, 0.437500, 0.026250, -0.410000, -0.835000
#*# 	0.898750, 0.496250, 0.032500, -0.415000, -0.835000
#*# x_count = 5
#*# y_count = 5
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 222.0
#*# min_y = 10.0
#*# max_y = 220.0
#*#
#*# [probe]
#*# z_offset = 19.750
